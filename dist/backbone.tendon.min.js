var Tendon=function(){return{}}();Tendon.utl=function(){return{strCapitalize:function(a){return a.replace(/^./,function(a){return a.toUpperCase()})}}}(),Tendon.MethodRouter=function(){"use strict";return Backbone.Router.extend({initialize:function(a){this.options=_.extend({defaultRoute:"main"},a),this.methods=this.options.methods||[this.options.defaultRoute],this.vein=this.options.vein||new Tendon.Vein},addMethod:function(){this.methods=_.union(this.methods,_.toArray(arguments))},removeMethod:function(){this.methods=_.difference(this.methods,_.toArray(arguments))},routes:function(){for(var a={"":"action"},b=0;10>=b;b++){for(var c=[],d=0;b>=d;d++)c.push(":"+d);a[c.join("/")+"*"]="action"}return a}(),action:function(){var a=Backbone.history.fragment.split("/"),b={};_.each(a,function(c,d){var e=c.split("?"),f=e.length>1?e[1].split("&"):[];a[d]=""==e[0]?void 0:e[0],_.each(f,function(a){var c=a.split("=");b[c[0]]=void 0!==c[1]?c[1]:null})}),a=_.compact(a),a=a.length>0?a:[this.options.defaultRoute],_.defer(_.bind(function(){this.vein.trigger("route",a,b),this.isMethod(a[0])?this.vein.trigger("route:known",a,b):this.vein.trigger("route:unknown",a,b),this.vein.trigger("route:"+a[0],a,b)},this))},nav:function(a,b){this.navigate(a,{trigger:b||!0})},isMethod:function(a){return void 0===a?!1:_.contains(this.options.methods,a)||a==this.options.defaultRoute}})}(),Tendon.Vein=function(){"use strict";var a=function(){};return a.extend=Backbone.View.extend,_.extend(a.prototype,Backbone.Events),a}(),Tendon.View=function(){return Backbone.View.extend({initialize:function(a){Backbone.View.prototype.initialize.apply(this,arguments),_.extend(this,{vein:_.result(this,"vein")||new Tendon.Vein,model:_.result(this,"model")||new Backbone.Model},a),this.options=a,this.events=this.setupUIEvents(_.result(this,"events")),this.vein.trigger("render:before",this,this.$el),this.onBeforeRender&&_.isFunction(this.onBeforeRender)&&this.onBeforeRender(this,this.$el),this.render(this.model),_.defer(_.bind(function(){this.ui&&this.initUI(this.ui),this.vein.trigger("render",this,this.$el),this.onRender&&_.isFunction(this.onRender)&&this.onRender(this,this.$el)},this))},render:function(a){_.isFunction(this.template)?this.setElement(this.template(a.attributes)):_.isString(this.template)&&this.setElement(_.template(this.template,a.attributes))},close:function(){this.remove(),this.unbind(),this.onClose&&_.isFunction(this.onClose)&&_.defer(_.bind(function(){this.onClose(this)},this)),this.vein.trigger("close",this)},initUI:function(a){var b=this;this.ui=function(){var c={};for(var d in a)c[d]=b.$el.find(a[d]);return c}()},setupUIEvents:function(a){return"undefined"!=typeof a?(_.each(_.keys(a),function(b){var c=b.split("@ui.");2===c.length&&(a[c[0]+this.ui[c[1]]]=a[b],delete a[b])},this),a):void 0},state:function(a,b){return _.isUndefined(b)||!_.isBoolean(b)?this.$el.hasClass("is-"+a):void(b?this.$el.addClass("is-"+a):this.$el.removeClass("is-"+a))}})}(),Tendon.Yield=function(){"use strict";var a={insertMethod:"append"},b=Tendon.View.extend({initialize:function(a){Tendon.View.prototype.initialize.call(this,a),this.childViews={}},_insert:function(b,c){void 0===this.childViews[b]?(this.childViews[b]=c,this.$el[a.insertMethod](c.el)):this.replace(b,c)},insert:function(){var b=_.toArray(arguments);_.isString(b[0])&&b[1]instanceof Backbone.View?this._insert(b[0],b[1]):b[0]instanceof Backbone.View?this._insert(b[0].cid,b[0]):_.isFunction(b[0])&&b[0].call(this,a)},find:function(){var b=_.toArray(arguments);return b[0]instanceof Backbone.View?this.childViews[b[0].cid]:_.isString(b[0])?this.childViews[b[0]]:_.isFunction(b[0])?b[0].call(this,a):_.map(this.childViews,function(a){return a})},_replace:function(a,b){return void 0===this.childViews[a]?void this._insert(a,b):(this.childViews[a].$el.replaceWith(b.el),this.childViews[a].close(),void(this.childViews[a]=b))},replace:function(){var b=_.toArray(arguments);b[0]instanceof Backbone.View&&b[1]instanceof Backbone.View?this._replace(b[0].cid,b[0]):_.isString(b[0])&&b[1]instanceof Backbone.View?this._replace(b[0],b[0]):_.isFunction(b[0])&&b[0].call(this,a)},_remove:function(a){_.isUndefined(this.childViews[a])||(this.childViews[a].close(),delete this.childViews[a])},remove:function(){var b=_.toArray(arguments);b[0]instanceof Backbone.View?this._remove(b[0].cid):_.isString(b[0])?this._remove(b[0]):_.isFunction(b[0])&&b[0].call(this,a)},empty:function(){_.each(this.childViews,function(a){void 0!==a.close&&a.close()})}}),c=["forEach","each","map","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return _.each(c,function(a){b.prototype[a]=function(){var b=_.values(this.childViews),c=[b].concat(_.toArray(arguments));return _[a].apply(_,c)}}),b}(),Tendon.Layout=function(){"use strict";return Tendon.View.extend({initialize:function(a){Tendon.View.prototype.initialize.call(this,a),this.vein.on("render",_.bind(function(){this.initLayout(this.layout||this.options.layout)},this))},initLayout:function(a){var b=this;this.layout=function(){var c={};for(var d in a)c[d]=new(Tendon.Yield.extend())({el:b.$el.find(a[d])});return c}()}})}(),Tendon.Composer=function(){"use strict";var a=Tendon.Layout.extend({initialize:function(a){Tendon.Layout.prototype.initialize.call(this,a),this.routes=a.routes||this.routes||["main"],this.router=new Tendon.MethodRouter({methods:this.routes,vein:this.vein,defaultRoute:a.defaultRoute||this.routes[0]}),this._initListeners(),this.vein.on("render",_.bind(function(){this.children=a.children||this.children,this.addChildren()},this))},_initListeners:function(){var a=this;_.each(this.routes,function(b){a.vein.on("route:"+b,function(c,d){var e="on"+Tendon.utl.strCapitalize(b),f=a.options[e]||a[e];_.isFunction(f)&&f.call(a,c,d)})}),this.vein.on("route:unknown",function(b,c){var d=a.options.onUnknownRoute||a.onUnknownRoute;_.isFunction(d)&&d.call(a,b,c)}),this.vein.on("route:known",function(b,c){var d=a.options.onKnownRoute||a.onKnownRoute;_.isFunction(d)&&d.call(a,b,c)})},addChildren:function(){var a=this;_.each(this.children,function(b,c){var d=_.result(a.children,c);a.layout[c]&&a.layout[c].insert(d)})}});return a}(),Tendon.JsonpCollection=function(){"use strict";return Backbone.Collection.extend({sync:function(a,b,c){var d=_.extend({type:"GET",url:this.url(),dataType:"jsonp",processData:!1},c);return $.ajax(d)},parse:function(a){return this.type&&a[this.type]?a[this.type]:a}})}();